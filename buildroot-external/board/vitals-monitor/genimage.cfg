# =============================================================================
# Vitals Monitor - SD Card Image Layout for STM32MP157F-DK2
#
# STM32MP1 boot sequence: ROM -> FSBL (TF-A) -> SSBL (U-Boot) -> Linux
#
# GPT partition layout:
#   1: fsbl1    - 256K  - TF-A BL2 primary   (raw, stm32 header)
#   2: fsbl2    - 256K  - TF-A BL2 backup     (raw, stm32 header)
#   3: ssbl     - 2M    - U-Boot              (raw, stm32 header)
#   4: rootfsA  - 256M  - Active root filesystem  (ext4)
#   5: rootfsB  - 256M  - Standby root filesystem (ext4, OTA target)
#   6: data     - rest  - Persistent data      (ext4, /opt/vitals-monitor/data)
# =============================================================================

image boot.vfat {
	vfat {
		# Empty - boot is handled by raw partitions on STM32MP1
	}
	size = 0
}

image sdcard.img {
	hdimage {
		gpt = true
	}

	# Partition 1: FSBL primary (TF-A BL2)
	partition fsbl1 {
		image = "tf-a-stm32mp157f-dk2.stm32"
		offset = 0x4400
		size = 256K
		partition-type-uuid = 0x8301
	}

	# Partition 2: FSBL backup (TF-A BL2 copy)
	partition fsbl2 {
		image = "tf-a-stm32mp157f-dk2.stm32"
		size = 256K
		partition-type-uuid = 0x8301
	}

	# Partition 3: SSBL (U-Boot)
	partition ssbl {
		image = "u-boot.stm32"
		size = 2M
		partition-type-uuid = 0x8301
	}

	# Partition 4: Active root filesystem
	partition rootfsA {
		image = "rootfs.ext4"
		partition-type-uuid = "B921B045-1DF0-41C3-AF44-4C6F280D3FAE"
		bootable = true
		size = 256M
	}

	# Partition 5: Standby root filesystem (OTA target)
	partition rootfsB {
		partition-type-uuid = "B921B045-1DF0-41C3-AF44-4C6F280D3FAE"
		size = 256M
	}

	# Partition 6: Persistent data partition
	partition data {
		image = "data.ext4"
		partition-type-uuid = "0FC63DAF-8483-4772-8E79-3D69D8477DE4"
		size = 512M
	}
}

image data.ext4 {
	ext4 {
		label = "data"
		use-mke2fs = true
	}
	size = 512M
}
